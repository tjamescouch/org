#!/usr/bin/env bash
# org wrapper: always run the app from this repository,
# but keep the user's working directory where they invoked `org`.

set -euo pipefail

# Directory where this script itself resides (the project root)
APPDIR="$(cd "$(dirname "$0")" && pwd)"
ENTRY="$APPDIR/src/app.ts"

# Make sure repo-local tools are discoverable (like apply_patch)
export PATH="$APPDIR:$APPDIR/scripts:$PATH"

# Preserve the caller's working directory.
CWD="$(pwd)"

# Check entrypoint
if [[ ! -f "$ENTRY" ]]; then
  echo "org: entrypoint not found at $ENTRY" >&2
  exit 66
fi

# Require Bun
if ! command -v bun >/dev/null 2>&1; then
  echo "org: bun is not installed or not in PATH" >&2
  exit 127
fi

# Run the app in the caller's working directory
cd "$CWD"
exec bun "$ENTRY" "$@"

