#!/usr/bin/env bash
# baked tmux wrapper
# DEV  -> rsync /project/scripts -> /scripts ; exec /scripts/org-launch-tmux
# PROD -> exec /usr/local/libexec/org/org-launch-tmux
set -Eeuo pipefail

MODE="${BUILD_MODE:-development}"

if [[ "$MODE" == "development" ]]; then
  if command -v org-sync-scripts.sh >/dev/null 2>&1; then
    org-sync-scripts.sh || true
  fi
  target="/scripts/org-launch-tmux"
else
  target="/usr/local/libexec/org/org-launch-tmux"
fi

if [[ ! -x "$target" ]]; then
  echo "org(launch-tmux): launcher not found or not executable: $target" >&2
  echo "mode=$MODE  (set BUILD_MODE=development to pull from /project/scripts)" >&2
  exit 127
fi

exec "$target" "$@"
